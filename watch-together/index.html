<!DOCTYPE html>  <html lang="en">  
<head>  
  <meta charset="UTF-8" />  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />  
  <title>Watch Together Chat</title>  
  <style>  
    body {  
      margin: 0;  
      font-family: Arial, sans-serif;  
      background-color: #0d0d0d;  
      color: white;  
      height: 100vh;  
      display: flex;  
      flex-direction: column;  
    }  #video-container {  
  height: 60%;  
  background: black;  
}  

iframe {  
  width: 100%;  
  height: 100%;  
}  

#chat-container {  
  height: 40%;  
  background: #1a1a1a;  
  display: flex;  
  flex-direction: column;  
  padding: 10px;  
}  

#chat-box {  
  flex: 1;  
  overflow-y: auto;  
  padding-right: 10px;  
}  

.message {  
  max-width: 80%;  
  margin: 8px;  
  padding: 8px 12px;  
  border-radius: 8px;  
  word-wrap: break-word;  
  position: relative;  
}  

.own {  
  background-color: #075e54;  
  color: white;  
  margin-left: auto;  
  border-bottom-right-radius: 0;  
}  

.other {  
  background-color: #2a2a2a;  
  color: white;  
  border-bottom-left-radius: 0;  
}  

.name {  
  font-weight: bold;  
  margin-bottom: 2px;  
}  

.reply-box {  
  background: #1f1f1f;  
  padding: 4px 8px;  
  border-left: 4px solid limegreen;  
  font-size: 0.9em;  
  margin-bottom: 4px;  
}  

.replied-to {  
  color: limegreen;  
}  

#chat-input {  
  display: flex;  
  margin-top: 5px;  
}  

#chat-input input {  
  flex: 1;  
  padding: 10px;  
  border-radius: 4px;  
  border: none;  
  outline: none;  
  background-color: #2a2a2a;  
  color: white;  
}  

#chat-input button {  
  background-color: #25d366;  
  border: none;  
  padding: 10px 16px;  
  border-radius: 4px;  
  margin-left: 5px;  
  cursor: pointer;  
}  

#change-username-button {  
  margin-top: 5px;  
  background-color: #007bff;  
  border: none;  
  padding: 8px;  
  color: white;  
  border-radius: 4px;  
  cursor: pointer;  
}  

.quoted {  
  font-size: 0.85em;  
  opacity: 0.9;  
}  

.message:hover {  
  cursor: pointer;  
}

  </style>  
</head>  
<body>  
  <div id="video-container">  
    <iframe src="https://drive.google.com/file/d/1KO8rfrxFHPZUtcV7TYPwWX2XYNkT2UgL/preview" allowfullscreen></iframe>  
  </div>  
  <div id="chat-container">  
    <div id="chat-box"></div>  
    <div id="chat-input">  
      <input type="text" id="message" placeholder="Type a message..." />  
      <button id="send">Send</button>  
    </div>  
    <button id="change-username-button">Change Username</button>  
  </div>    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>    <script>  
    const socket = io("https://zigzag-bird-orchestra.glitch.me/"); // Replace with your server  
    const chatBox = document.getElementById("chat-box");  
    const messageInput = document.getElementById("message");  
    const sendButton = document.getElementById("send");  
    const changeUsernameButton = document.getElementById("change-username-button");  
  
    const userColors = {};  
    let replyTo = null;  
  
    function getColorForUsername(username) {  
      if (!userColors[username]) {  
        const hue = Math.floor(Math.random() * 360);  
        userColors[username] = `hsl(${hue}, 70%, 60%)`;  
      }  
      return userColors[username];  
    }  
  
    let username = localStorage.getItem("username") || prompt("Enter a username:");  
    socket.emit("checkUsername", username);  
  
    socket.on("usernameExists", () => {  
      alert("Username already taken! Enter a different one.");  
      username = prompt("New username:");  
      localStorage.setItem("username", username);  
      socket.emit("checkUsername", username);  
    });  
  
    localStorage.setItem("username", username);  
  
    sendButton.onclick = () => {  
      const message = messageInput.value.trim();  
      if (!message) return;  
      socket.emit("chatMessage", { username, message, replyTo });  
      messageInput.value = "";  
      replyTo = null;  
    };  
  
    function appendMessage(data, isOwn) {  
      const msgDiv = document.createElement("div");  
      msgDiv.classList.add("message");  
      msgDiv.classList.add(isOwn ? "own" : "other");  
      msgDiv.onclick = () => {  
        replyTo = data;  
        messageInput.placeholder = `Replying to ${data.username}: ${data.message}`;  
      };  
  
      if (!isOwn) {  
        const name = document.createElement("div");  
        name.className = "name";  
        name.textContent = data.username;  
        name.style.color = getColorForUsername(data.username);  
        msgDiv.appendChild(name);  
      }  
  
      if (data.replyTo) {  
        const replyBox = document.createElement("div");  
        replyBox.className = "reply-box";  
        replyBox.innerHTML = `<span class='replied-to'>${data.replyTo.username}:</span> ${data.replyTo.message}`;  
        msgDiv.appendChild(replyBox);  
      }  
  
      const text = document.createElement("div");  
      text.textContent = data.message;  
      msgDiv.appendChild(text);  
  
      chatBox.appendChild(msgDiv);  
      chatBox.scrollTop = chatBox.scrollHeight;  
    }  
  
    socket.on("chatMessage", (data) => {  
      appendMessage(data, data.username === username);  
    });  
  
    socket.on("loadMessages", (messages) => {  
      messages.forEach((m) => appendMessage(m, m.username === username));  
    });  
  
    changeUsernameButton.onclick = () => {  
      const newUsername = prompt("Enter a new username:");  
      if (newUsername && newUsername !== username) {  
        socket.emit("checkUsername", newUsername);  
        socket.on("usernameAvailable", () => {  
          username = newUsername;  
          localStorage.setItem("username", username);  
          alert("Username changed successfully!");  
        });  
      }  
    };  
  </script>  </body>  
</html>  
